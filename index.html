<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Emulator</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #111827;
            color: white;
        }
        
        .hidden {
            display: none;
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .transition {
            transition: all 0.3s ease;
        }
        
        .rounded {
            border-radius: 0.25rem;
        }
        
        .rounded-lg {
            border-radius: 0.5rem;
        }
        
        .rounded-xl {
            border-radius: 0.75rem;
        }
        
        .rounded-2xl {
            border-radius: 1rem;
        }
        
        .rounded-3xl {
            border-radius: 1.5rem;
        }
        
        .bg-gray-700 {
            background-color: #374151;
        }
        
        .bg-gray-800 {
            background-color: #1f2937;
        }
        
        .bg-gray-900 {
            background-color: #111827;
        }
        
        .bg-blue-600 {
            background-color: #2563eb;
        }
        
        .bg-blue-700 {
            background-color: #1d4ed8;
        }
        
        .bg-green-600 {
            background-color: #16a34a;
        }
        
        .bg-green-700 {
            background-color: #15803d;
        }
        
        .bg-red-600 {
            background-color: #dc2626;
        }
        
        .bg-red-700 {
            background-color: #b91c1c;
        }
        
        .bg-yellow-600 {
            background-color: #d97706;
        }
        
        .bg-opacity-75 {
            background-color: rgba(31, 41, 55, 0.75);
        }
        
        .bg-opacity-90 {
            background-color: rgba(31, 41, 55, 0.9);
        }
        
        .hover\\:bg-gray-600:hover {
            background-color: #4b5563;
        }
        
        .hover\\:bg-gray-700:hover {
            background-color: #374151;
        }
        
        .hover\\:bg-blue-700:hover {
            background-color: #1d4ed8;
        }
        
        .hover\\:bg-green-700:hover {
            background-color: #15803d;
        }
        
        .hover\\:bg-red-700:hover {
            background-color: #b91c1c;
        }
        
        .hover\\:bg-yellow-700:hover {
            background-color: #b45309;
        }
        
        .text-gray-400 {
            color: #9ca3af;
        }
        
        .text-gray-500 {
            color: #6b7280;
        }
        
        .text-gray-600 {
            color: #4b5563;
        }
        
        .text-blue-400 {
            color: #60a5fa;
        }
        
        .text-green-400 {
            color: #4ade80;
        }
        
        .text-red-400 {
            color: #f87171;
        }
        
        .text-yellow-400 {
            color: #fbbf24;
        }
        
        .border-gray-600 {
            border-color: #4b5563;
        }
        
        .border-gray-700 {
            border-color: #374151;
        }
        
        .border-green-700 {
            border-color: #166534;
        }
        
        .border-yellow-700 {
            border-color: #b45309;
        }
        
        .border-red-700 {
            border-color: #b91c1c;
        }
        
        .border-b-2 {
            border-bottom-width: 2px;
        }
        
        .border-b {
            border-bottom-width: 1px;
        }
        
        .border {
            border-width: 1px;
        }
        
        .p-2 {
            padding: 0.5rem;
        }
        
        .p-3 {
            padding: 0.75rem;
        }
        
        .p-4 {
            padding: 1rem;
        }
        
        .p-6 {
            padding: 1.5rem;
        }
        
        .px-2 {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }
        
        .px-3 {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        .py-1 {
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }
        
        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        
        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }
        
        .m-3 {
            margin: 0.75rem;
        }
        
        .mb-2 {
            margin-bottom: 0.5rem;
        }
        
        .mb-3 {
            margin-bottom: 0.75rem;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mt-1 {
            margin-top: 0.25rem;
        }
        
        .mt-2 {
            margin-top: 0.5rem;
        }
        
        .mt-3 {
            margin-top: 0.75rem;
        }
        
        .mt-4 {
            margin-top: 1rem;
        }
        
        .w-4 {
            width: 1rem;
        }
        
        .w-5 {
            width: 1.25rem;
        }
        
        .h-4 {
            height: 1rem;
        }
        
        .h-5 {
            height: 1.25rem;
        }
        
        .w-full {
            width: 100%;
        }
        
        .max-w-2xl {
            max-width: 42rem;
        }
        
        .max-h-\[80vh\] {
            max-height: 80vh;
        }
        
        .flex {
            display: flex;
        }
        
        .flex-1 {
            flex: 1 1 0%;
        }
        
        .flex-col {
            flex-direction: column;
        }
        
        .items-center {
            align-items: center;
        }
        
        .items-start {
            align-items: flex-start;
        }
        
        .justify-center {
            justify-content: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .gap-2 {
            gap: 0.5rem;
        }
        
        .gap-4 {
            gap: 1rem;
        }
        
        .text-sm {
            font-size: 0.875rem;
        }
        
        .text-xs {
            font-size: 0.75rem;
        }
        
        .font-medium {
            font-weight: 500;
        }
        
        .font-bold {
            font-weight: 700;
        }
        
        .whitespace-nowrap {
            white-space: nowrap;
        }
        
        .list-decimal {
            list-style-type: decimal;
        }
        
        .list-inside {
            list-style-position: inside;
        }
        
        .space-y-1 > * + * {
            margin-top: 0.25rem;
        }
        
        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }
        
        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }
        
        .space-y-4 > * + * {
            margin-top: 1rem;
        }
        
        .overflow-hidden {
            overflow: hidden;
        }
        
        .overflow-y-auto {
            overflow-y: auto;
        }
        
        .overflow-x-auto {
            overflow-x: auto;
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .shadow-2xl {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .disabled\\:bg-gray-600:disabled {
            background-color: #4b5563;
        }
        
        .disabled\\:text-gray-600:disabled {
            color: #4b5563;
        }
        
        .cursor-default {
            cursor: default;
        }
        
        .text-center {
            text-align: center;
        }
        
        .break-all {
            word-break: break-all;
        }
        
        .font-mono {
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
        }
        
        .whitespace-pre-wrap {
            white-space: pre-wrap;
        }
        
        .grid {
            display: grid;
        }
        
        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        
        .grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }
        
        .gap-x-4 {
            column-gap: 1rem;
        }
        
        .gap-y-1 {
            row-gap: 0.25rem;
        }
        
        .flex-shrink-0 {
            flex-shrink: 0;
        }
        
        .ml-2 {
            margin-left: 0.5rem;
        }
        
        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
        
        .absolute {
            position: absolute;
        }
        
        .fixed {
            position: fixed;
        }
        
        .z-50 {
            z-index: 50;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const {
            Play, Square, RotateCw, Settings, Wifi, Terminal, Package, Shield, 
            Activity, Download, Upload, Smartphone, Menu, X, Power, AlertCircle, 
            CheckCircle, Loader
        } = lucide;

        function LucideIcon({ icon, className }) {
            const IconComponent = icon;
            return React.createElement(IconComponent, { className: className });
        }

        function AndroidEmulator() {
            const [isRunning, setIsRunning] = React.useState(false);
            const [orientation, setOrientation] = React.useState('portrait');
            const [proxyEnabled, setProxyEnabled] = React.useState(false);
            const [proxyType, setProxyType] = React.useState('burp');
            const [proxyConfig, setProxyConfig] = React.useState({ host: '127.0.0.1', port: '8080' });
            const [pythonPackages, setPythonPackages] = React.useState([]);
            const [packageInput, setPackageInput] = React.useState('');
            const [sidePanelOpen, setSidePanelOpen] = React.useState(true);
            const [activeTab, setActiveTab] = React.useState('apps');
            const [logs, setLogs] = React.useState([]);
            const [installedApps, setInstalledApps] = React.useState([]);
            const [traffic, setTraffic] = React.useState([]);
            const [captureTraffic, setCaptureTraffic] = React.useState(false);
            const [currentApp, setCurrentApp] = React.useState(null);
            const [apkUrl, setApkUrl] = React.useState('');
            const [isProcessing, setIsProcessing] = React.useState(false);
            const [emulatorState, setEmulatorState] = React.useState({
                screen: 'home',
                apps: [],
                systemInfo: {
                    android: '13.0',
                    api: '33',
                    memory: '2048 MB',
                    storage: '8 GB'
                }
            });
            const [emulatorStats, setEmulatorStats] = React.useState({
                cpu: '0%',
                memory: '0/2048 MB',
                network: '0 KB/s'
            });
            const [selectedTraffic, setSelectedTraffic] = React.useState(null);
            
            const canvasRef = React.useRef(null);
            const fileInputRef = React.useRef(null);

            React.useEffect(() => {
                if (canvasRef.current) {
                    const ctx = canvasRef.current.getContext('2d');
                    drawScreen(ctx);
                }
            }, [isRunning, orientation, emulatorState.screen, currentApp]);

            // Enhanced system monitoring
            React.useEffect(() => {
                if (!isRunning) return;
                
                const statsInterval = setInterval(() => {
                    setEmulatorStats({
                        cpu: `${Math.floor(Math.random() * 30) + 10}%`,
                        memory: `${Math.floor(Math.random() * 512) + 512}/2048 MB`,
                        network: `${Math.floor(Math.random() * 50) + 10} KB/s`
                    });
                }, 2000);
                
                return () => clearInterval(statsInterval);
            }, [isRunning]);

            const drawScreen = (ctx) => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                if (isRunning) {
                    // Background
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, '#667eea');
                    gradient.addColorStop(1, '#764ba2');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // Status bar
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                    ctx.fillRect(0, 0, canvas.width, 30);
                    ctx.fillStyle = 'white';
                    ctx.font = '12px Arial';
                    ctx.fillText('12:00', 10, 20);
                    ctx.fillText(proxyEnabled ? 'ðŸ”’ Proxy' : 'ðŸ“¶ WiFi', canvas.width - 80, 20);

                    if (currentApp) {
                        // App is running
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                        ctx.fillRect(0, 30, canvas.width, canvas.height - 30);
                        ctx.fillStyle = '#333';
                        ctx.font = 'bold 16px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(currentApp.name, canvas.width / 2, 70);
                        
                        // App content area
                        ctx.strokeStyle = '#ddd';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(20, 100, canvas.width - 40, canvas.height - 180);
                        ctx.font = '14px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('App is running...', canvas.width / 2, canvas.height / 2);
                        ctx.fillText('Intercepting traffic', canvas.width / 2, canvas.height / 2 + 30);
                        
                        // Back button
                        ctx.fillStyle = '#667eea';
                        ctx.fillRect(20, canvas.height - 60, 100, 40);
                        ctx.fillStyle = 'white';
                        ctx.font = 'bold 14px Arial';
                        ctx.fillText('â† Back', 70, canvas.height - 35);
                    } else {
                        // Home screen
                        ctx.fillStyle = 'white';
                        ctx.font = '18px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('Android Emulator', canvas.width / 2, 60);
                        
                        // App grid
                        const apps = installedApps.slice(0, 6);
                        apps.forEach((app, idx) => {
                            const col = idx % 3;
                            const row = Math.floor(idx / 3);
                            const x = 40 + col * 110;
                            const y = 100 + row * 130;
                            
                            // App icon
                            ctx.fillStyle = '#4299e1';
                            ctx.fillRect(x, y, 80, 80);
                            ctx.fillStyle = 'white';
                            ctx.font = 'bold 24px Arial';
                            ctx.fillText(app.name.charAt(0), x + 40, y + 50);
                            
                            // App name
                            ctx.fillStyle = 'white';
                            ctx.font = '12px Arial';
                            ctx.fillText(app.name.substring(0, 10), x + 40, y + 100);
                        });

                        if (apps.length === 0) {
                            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                            ctx.font = '14px Arial';
                            ctx.fillText('No apps installed', canvas.width / 2, 150);
                            ctx.fillText('Upload an APK to get started', canvas.width / 2, 180);
                        }
                    }
                } else {
                    ctx.fillStyle = '#1a1a1a';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#555';
                    ctx.font = '18px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('â»', canvas.width / 2, canvas.height / 2 - 20);
                    ctx.fillText('Emulator Stopped', canvas.width / 2, canvas.height / 2 + 20);
                }
            };

            const addLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => [...prev, { time: timestamp, message, type }].slice(-100));
            };

            const toggleEmulator = () => {
                const newState = !isRunning;
                setIsRunning(newState);
                if (newState) {
                    addLog('ðŸš€ Android emulator started (API 33)', 'success');
                    addLog('ðŸ“± Device: Pixel 6 Pro', 'info');
                    addLog('ðŸ’¾ Memory: 2048 MB allocated', 'info');
                } else {
                    addLog('â¹ï¸ Emulator stopped', 'info');
                    setCurrentApp(null);
                }
            };

            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                if (!file.name.endsWith('.apk')) {
                    addLog('âŒ Error: File must be an APK', 'error');
                    return;
                }

                setIsProcessing(true);
                addLog(`ðŸ“¦ Installing ${file.name}...`, 'info');

                // Simulate APK processing
                setTimeout(() => {
                    const appName = file.name.replace('.apk', '');
                    const newApp = {
                        id: Date.now(),
                        name: appName,
                        package: `com.${appName.toLowerCase().replace(/\s/g, '')}`,
                        version: '1.0',
                        size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                        file: file
                    };

                    setInstalledApps(prev => [...prev, newApp]);
                    addLog(`âœ… ${appName} installed successfully`, 'success');
                    addLog(`ðŸ“ Package: ${newApp.package}`, 'info');
                    setIsProcessing(false);
                    
                    if (!isRunning) {
                        setIsRunning(true);
                        addLog('ðŸš€ Emulator auto-started', 'info');
                    }
                }, 2000);
            };

            const downloadApk = async () => {
                if (!apkUrl.trim()) {
                    addLog('âŒ Please enter a valid URL', 'error');
                    return;
                }

                setIsProcessing(true);
                addLog(`ðŸŒ Downloading APK from URL...`, 'info');
                addLog(`ðŸ”— ${apkUrl}`, 'info');

                // Simulate download
                setTimeout(() => {
                    const appName = 'Downloaded App ' + Date.now();
                    const newApp = {
                        id: Date.now(),
                        name: appName,
                        package: `com.downloaded.app${Date.now()}`,
                        version: '1.0',
                        size: '5.2 MB',
                        url: apkUrl
                    };

                    setInstalledApps(prev => [...prev, newApp]);
                    addLog(`âœ… Download complete: ${appName}`, 'success');
                    addLog(`ðŸ“ Package: ${newApp.package}`, 'info');
                    setIsProcessing(false);
                    setApkUrl('');
                    
                    if (!isRunning) {
                        setIsRunning(true);
                        addLog('ðŸš€ Emulator auto-started', 'info');
                    }
                }, 3000);
            };

            // Enhanced traffic simulation with more realistic data
            const simulateAppTraffic = (app) => {
                const endpoints = [
                    { path: '/api/v1/auth/login', methods: ['POST'] },
                    { path: '/api/v1/user/profile', methods: ['GET', 'POST'] },
                    { path: '/api/v1/data/sync', methods: ['POST', 'PUT'] },
                    { path: '/api/v1/config', methods: ['GET'] },
                    { path: '/api/v1/analytics', methods: ['POST'] },
                    { path: '/api/v1/push/register', methods: ['POST'] }
                ];
                
                let count = 0;
                const interval = setInterval(() => {
                    if (count >= 8 || !currentApp) {
                        clearInterval(interval);
                        return;
                    }
                    
                    const endpoint = endpoints[count % endpoints.length];
                    const method = endpoint.methods[Math.floor(Math.random() * endpoint.methods.length)];
                    const statusCodes = [200, 201, 400, 401, 403, 500];
                    const status = statusCodes[Math.floor(Math.random() * statusCodes.length)];
                    
                    const newTraffic = {
                        id: Date.now() + count,
                        app: app.name,
                        method: method,
                        url: `https://${app.package.split('.')[1] || 'api'}.com${endpoint.path}`,
                        status: status,
                        time: new Date().toLocaleTimeString(),
                        size: Math.floor(Math.random() * 5000) + ' B',
                        headers: {
                            'User-Agent': 'Dalvik/2.1.0 (Linux; U; Android 13; Build/TP1A.220624.014)',
                            'Content-Type': 'application/json',
                            'Authorization': method === 'POST' ? 'Bearer eyJ0eXAi...' : null
                        },
                        body: method === 'POST' ? JSON.stringify({
                            user: "test@example.com",
                            token: "abc123",
                            timestamp: new Date().toISOString()
                        }, null, 2) : null
                    };
                    
                    setTraffic(prev => [newTraffic, ...prev].slice(-100));
                    
                    const logType = status >= 400 ? 'error' : 'info';
                    addLog(`ðŸ“¡ ${method} ${endpoint.path} - ${status}`, logType);
                    count++;
                }, 1200);
            };

            const uninstallApp = (appId) => {
                const app = installedApps.find(a => a.id === appId);
                if (app) {
                    setInstalledApps(prev => prev.filter(a => a.id !== appId));
                    addLog(`ðŸ—‘ï¸ Uninstalled ${app.name}`, 'info');
                    if (currentApp?.id === appId) {
                        setCurrentApp(null);
                    }
                }
            };

            const installPackage = () => {
                if (packageInput.trim()) {
                    setIsProcessing(true);
                    addLog(`ðŸ“¦ Installing Python package: ${packageInput}...`, 'info');
                    
                    setTimeout(() => {
                        setPythonPackages(prev => [...prev, { 
                            name: packageInput, 
                            status: 'installed',
                            version: '1.0.0'
                        }]);
                        addLog(`âœ… Successfully installed ${packageInput}`, 'success');
                        setPackageInput('');
                        setIsProcessing(false);
                    }, 1500);
                }
            };

            const toggleProxy = () => {
                const newState = !proxyEnabled;
                setProxyEnabled(newState);
                if (newState) {
                    addLog(`ðŸ”’ Proxy enabled: ${proxyType}`, 'success');
                    addLog(`ðŸŒ Forwarding to ${proxyConfig.host}:${proxyConfig.port}`, 'info');
                    addLog(`ðŸ“¡ Certificate installed in system trust store`, 'info');
                } else {
                    addLog(`ðŸ”“ Proxy disabled`, 'info');
                    setCaptureTraffic(false);
                }
            };

            const handleCanvasClick = (e) => {
                if (!isRunning) return;
                
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const canvasX = x * scaleX;
                const canvasY = y * scaleY;

                if (currentApp) {
                    // Check back button
                    if (canvasY > canvas.height - 60 && canvasX < 120) {
                        setCurrentApp(null);
                        addLog(`â¬…ï¸ Returned to home screen`, 'info');
                    }
                } else {
                    // Check app icons
                    installedApps.slice(0, 6).forEach((app, idx) => {
                        const col = idx % 3;
                        const row = Math.floor(idx / 3);
                        const iconX = 40 + col * 110;
                        const iconY = 100 + row * 130;
                        
                        if (canvasX >= iconX && canvasX <= iconX + 80 &&
                            canvasY >= iconY && canvasY <= iconY + 80) {
                            launchApp(app);
                        }
                    });
                }
            };

            const launchApp = (app) => {
                if (!isRunning) {
                    addLog('âŒ Start emulator first', 'error');
                    return;
                }
                
                setCurrentApp(app);
                addLog(`ðŸš€ Launching ${app.name}...`, 'info');
                addLog(`ðŸ“¦ Package: ${app.package}`, 'info');
                
                if (proxyEnabled) {
                    addLog(`ðŸ”’ Routing traffic through ${proxyType}`, 'info');
                    setCaptureTraffic(true);
                    simulateAppTraffic(app);
                }
            };

            const canvasWidth = orientation === 'portrait' ? 360 : 640;
            const canvasHeight = orientation === 'portrait' ? 640 : 360;

            // TrafficDetails component
            const TrafficDetails = ({ traffic }) => {
                if (!traffic) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
                        <div className="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-bold">Request Details</h3>
                                <button 
                                    onClick={() => setSelectedTraffic(null)}
                                    className="p-1 hover:bg-gray-700 rounded"
                                >
                                    <LucideIcon icon={X} className="w-5 h-5" />
                                </button>
                            </div>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="text-sm font-medium text-gray-400">URL</label>
                                    <div className="mt-1 p-2 bg-gray-700 rounded font-mono text-sm break-all">
                                        {traffic.url}
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-3 gap-4">
                                    <div>
                                        <label className="text-sm font-medium text-gray-400">Method</label>
                                        <div className={`mt-1 p-2 rounded text-center font-bold ${
                                            traffic.method === 'GET' ? 'bg-blue-600' :
                                            traffic.method === 'POST' ? 'bg-green-600' :
                                            traffic.method === 'PUT' ? 'bg-yellow-600' : 'bg-red-600'
                                        }`}>
                                            {traffic.method}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="text-sm font-medium text-gray-400">Status</label>
                                        <div className={`mt-1 p-2 rounded text-center font-bold ${
                                            traffic.status < 300 ? 'bg-green-600' :
                                            traffic.status < 400 ? 'bg-blue-600' :
                                            traffic.status < 500 ? 'bg-yellow-600' : 'bg-red-600'
                                        }`}>
                                            {traffic.status}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="text-sm font-medium text-gray-400">Size</label>
                                        <div className="mt-1 p-2 bg-gray-700 rounded text-center">
                                            {traffic.size}
                                        </div>
                                    </div>
                                </div>
                                
                                {traffic.headers && (
                                    <div>
                                        <label className="text-sm font-medium text-gray-400">Headers</label>
                                        <div className="mt-1 p-2 bg-gray-700 rounded font-mono text-sm">
                                            {Object.entries(traffic.headers).map(([key, value]) => (
                                                value && (
                                                    <div key={key} className="flex">
                                                        <span className="text-blue-400 flex-shrink-0">{key}:</span>
                                                        <span className="ml-2 text-gray-300 break-all">{value}</span>
                                                    </div>
                                                )
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {traffic.body && (
                                    <div>
                                        <label className="text-sm font-medium text-gray-400">Body</label>
                                        <pre className="mt-1 p-2 bg-gray-700 rounded font-mono text-sm whitespace-pre-wrap break-all">
                                            {traffic.body}
                                        </pre>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex h-screen bg-gray-900 text-white">
                    {/* Main Emulator Area */}
                    <div className="flex-1 flex flex-col items-center justify-center p-8 relative">
                        {/* System stats display */}
                        <div className="absolute top-4 left-4 bg-gray-800 bg-opacity-90 rounded-lg p-3 text-xs">
                            <div className="grid grid-cols-2 gap-x-4 gap-y-1">
                                <div className="text-gray-400">CPU:</div>
                                <div className="text-green-400">{emulatorStats.cpu}</div>
                                
                                <div className="text-gray-400">Memory:</div>
                                <div className="text-blue-400">{emulatorStats.memory}</div>
                                
                                <div className="text-gray-400">Network:</div>
                                <div className="text-yellow-400">{emulatorStats.network}</div>
                            </div>
                        </div>

                        {/* Device Frame */}
                        <div className="bg-gray-800 rounded-3xl p-4 shadow-2xl relative" style={{
                            width: orientation === 'portrait' ? '400px' : '700px',
                            height: orientation === 'portrait' ? '720px' : '440px'
                        }}>
                            {/* Status Bar */}
                            <div className="flex justify-between items-center mb-2 px-2">
                                <div className="flex items-center gap-2">
                                    <div className={`w-2 h-2 rounded-full ${isRunning ? 'bg-green-500' : 'bg-red-500'} animate-pulse`}></div>
                                    <span className="text-xs text-gray-400">
                                        {isRunning ? 'Running' : 'Stopped'} | API 33
                                    </span>
                                </div>
                                <div className="flex items-center gap-2">
                                    {proxyEnabled && <LucideIcon icon={Shield} className="w-4 h-4 text-blue-400 animate-pulse" />}
                                    {isProcessing && <LucideIcon icon={Loader} className="w-4 h-4 text-yellow-400 animate-spin" />}
                                    <LucideIcon icon={Wifi} className={`w-4 h-4 ${isRunning ? 'text-green-400' : 'text-gray-600'}`} />
                                </div>
                            </div>

                            {/* Screen */}
                            <canvas
                                ref={canvasRef}
                                width={canvasWidth}
                                height={canvasHeight}
                                className="w-full rounded-2xl bg-black cursor-pointer"
                                onClick={handleCanvasClick}
                            />

                            {/* Hardware Buttons */}
                            <div className="flex justify-center gap-4 mt-3">
                                <button
                                    onClick={toggleEmulator}
                                    className={`p-2 rounded-full transition ${
                                        isRunning 
                                        ? 'bg-red-600 hover:bg-red-700' 
                                        : 'bg-green-600 hover:bg-green-700'
                                    }`}
                                    title={isRunning ? 'Stop' : 'Start'}
                                >
                                    <LucideIcon icon={isRunning ? Square : Play} className="w-4 h-4" />
                                </button>
                                <button
                                    onClick={() => {
                                        if (currentApp) {
                                            setCurrentApp(null);
                                            addLog('ðŸ  Home button pressed', 'info');
                                        }
                                    }}
                                    className="p-2 bg-gray-700 hover:bg-gray-600 rounded-full transition"
                                    disabled={!isRunning}
                                    title="Home"
                                >
                                    <LucideIcon icon={Smartphone} className="w-4 h-4" />
                                </button>
                                <button
                                    onClick={() => {
                                        setOrientation(orientation === 'portrait' ? 'landscape' : 'portrait');
                                        addLog(`ðŸ”„ Rotated to ${orientation === 'portrait' ? 'landscape' : 'portrait'}`, 'info');
                                    }}
                                    className="p-2 bg-gray-700 hover:bg-gray-600 rounded-full transition"
                                    disabled={!isRunning}
                                    title="Rotate"
                                >
                                    <LucideIcon icon={RotateCw} className="w-4 h-4" />
                                </button>
                            </div>
                        </div>

                        {/* Current App Info */}
                        {currentApp && (
                            <div className="mt-4 p-3 bg-gray-800 rounded-lg">
                                <div className="text-sm">
                                    <span className="text-gray-400">Running:</span>{' '}
                                    <span className="text-white font-medium">{currentApp.name}</span>
                                </div>
                                <div className="text-xs text-gray-500 mt-1">{currentApp.package}</div>
                            </div>
                        )}
                    </div>

                    {/* Side Panel */}
                    <div className={`${sidePanelOpen ? 'w-96' : 'w-0'} transition-all duration-300 bg-gray-800 overflow-hidden flex flex-col`}>
                        <div className="p-4 border-b border-gray-700 flex justify-between items-center">
                            <h2 className="text-lg font-bold">Dev Tools</h2>
                            <button onClick={() => setSidePanelOpen(false)} className="p-1 hover:bg-gray-700 rounded">
                                <LucideIcon icon={X} className="w-5 h-5" />
                            </button>
                        </div>

                        {/* Tabs */}
                        <div className="flex border-b border-gray-700 overflow-x-auto">
                            {['apps', 'proxy', 'python', 'traffic', 'logs'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`flex-1 py-3 px-2 text-sm font-medium transition whitespace-nowrap ${
                                        activeTab === tab ? 'bg-gray-700 text-white border-b-2 border-blue-500' : 'text-gray-400 hover:text-white'
                                    }`}
                                >
                                    {tab.charAt(0).toUpperCase() + tab.slice(1)}
                                </button>
                            ))}
                        </div>

                        {/* Tab Content */}
                        <div className="flex-1 overflow-y-auto p-4">
                            {/* Apps Tab */}
                            {activeTab === 'apps' && (
                                <div className="space-y-4">
                                    <div>
                                        <h3 className="text-sm font-medium mb-3">Install APK</h3>
                                        
                                        {/* Upload APK */}
                                        <button
                                            onClick={() => fileInputRef.current?.click()}
                                            disabled={isProcessing}
                                            className="w-full py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded flex items-center justify-center gap-2 transition"
                                        >
                                            <LucideIcon icon={Upload} className="w-4 h-4" />
                                            {isProcessing ? 'Processing...' : 'Upload APK File'}
                                        </button>
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept=".apk"
                                            onChange={handleFileUpload}
                                            className="hidden"
                                        />
                                    </div>

                                    {/* Download from URL */}
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Or Download from URL</label>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={apkUrl}
                                                onChange={(e) => setApkUrl(e.target.value)}
                                                placeholder="https://example.com/app.apk"
                                                className="flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm"
                                                disabled={isProcessing}
                                            />
                                            <button
                                                onClick={downloadApk}
                                                disabled={isProcessing || !apkUrl.trim()}
                                                className="px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded transition"
                                            >
                                                <LucideIcon icon={Download} className="w-4 h-4" />
                                            </button>
                                        </div>
                                    </div>

                                    {/* Installed Apps */}
                                    <div>
                                        <h3 className="text-sm font-medium mb-2">
                                            Installed Apps ({installedApps.length})
                                        </h3>
                                        <div className="space-y-2">
                                            {installedApps.length === 0 ? (
                                                <div className="text-sm text-gray-500 italic p-4 text-center">
                                                    No apps installed yet
                                                </div>
                                            ) : (
                                                installedApps.map((app) => (
                                                    <div key={app.id} className="p-3 bg-gray-700 rounded">
                                                        <div className="flex justify-between items-start mb-2">
                                                            <div>
                                                                <div className="font-medium text-sm">{app.name}</div>
                                                                <div className="text-xs text-gray-400 mt-1">{app.package}</div>
                                                                <div className="text-xs text-gray-500 mt-1">
                                                                    v{app.version} â€¢ {app.size}
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => uninstallApp(app.id)}
                                                                className="text-red-400 hover:text-red-300 text-xs"
                                                            >
                                                                Uninstall
                                                            </button>
                                                        </div>
                                                        <button
                                                            onClick={() => launchApp(app)}
                                                            disabled={!isRunning || currentApp?.id === app.id}
                                                            className="w-full py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded text-sm transition"
                                                        >
                                                            {currentApp?.id === app.id ? 'Running' : 'Launch'}
                                                        </button>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Proxy Tab */}
                            {activeTab === 'proxy' && (
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Proxy Type</label>
                                        <select
                                            value={proxyType}
                                            onChange={(e) => setProxyType(e.target.value)}
                                            className="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm"
                                        >
                                            <option value="burp">Burp Suite</option>
                                            <option value="mitmproxy">mitmproxy</option>
                                            <option value="charles">Charles Proxy</option>
                                            <option value="fiddler">Fiddler</option>
                                            <option value="proxyman">Proxyman</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Host</label>
                                        <input
                                            type="text"
                                            value={proxyConfig.host}
                                            onChange={(e) => setProxyConfig({...proxyConfig, host: e.target.value})}
                                            className="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm"
                                            placeholder="127.0.0.1"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Port</label>
                                        <input
                                            type="text"
                                            value={proxyConfig.port}
                                            onChange={(e) => setProxyConfig({...proxyConfig, port: e.target.value})}
                                            className="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm"
                                            placeholder="8080"
                                        />
                                    </div>

                                    <button
                                        onClick={toggleProxy}
                                        className={`w-full py-2 rounded font-medium transition ${
                                            proxyEnabled
                                            ? 'bg-red-600 hover:bg-red-700'
                                            : 'bg-blue-600 hover:bg-blue-700'
                                        }`}
                                    >
                                        {proxyEnabled ? 'ðŸ”“ Disable Proxy' : 'ðŸ”’ Enable Proxy'}
                                    </button>

                                    {proxyEnabled && (
                                        <div className="mt-4 p-3 bg-green-900/30 border border-green-700 rounded">
                                            <div className="flex items-center gap-2 text-green-400 text-sm font-medium">
                                                <LucideIcon icon={CheckCircle} className="w-4 h-4" />
                                                <span>Proxy Active</span>
                                            </div>
                                            <div className="mt-2 text-xs text-gray-300">
                                                <div>Type: {proxyType}</div>
                                                <div>Target: {proxyConfig.host}:{proxyConfig.port}</div>
                                                <div className="mt-2 text-green-400">
                                                    âœ“ Certificate installed
                                                </div>
                                                <div className="text-green-400">
                                                    âœ“ System proxy configured
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    <div className="p-3 bg-gray-700 rounded text-xs">
                                        <div className="font-medium mb-2">Configuration Steps:</div>
                                        <ol className="list-decimal list-inside space-y-1 text-gray-300">
                                            <li>Start your proxy tool ({proxyType})</li>
                                            <li>Set it to listen on {proxyConfig.host}:{proxyConfig.port}</li>
                                            <li>Enable proxy above to route traffic</li>
                                            <li>Launch an app to intercept requests</li>
                                        </ol>
                                    </div>
                                </div>
                            )}

                            {/* Python Tab */}
                            {activeTab === 'python' && (
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Install Python Package</label>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={packageInput}
                                                onChange={(e) => setPackageInput(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && installPackage()}
                                                className="flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm"
                                                placeholder="e.g., frida, objection, mitmproxy"
                                                disabled={isProcessing}
                                            />
                                            <button
                                                onClick={installPackage}
                                                disabled={isProcessing || !packageInput.trim()}
                                                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded text-sm transition"
                                            >
                                                <LucideIcon icon={Package} className="w-4 h-4" />
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="text-sm font-medium mb-2">Installed Packages ({pythonPackages.length})</h3>
                                        <div className="space-y-2">
                                            {pythonPackages.length === 0 ? (
                                                <div className="text-sm text-gray-500 italic text-center py-4">
                                                    No packages installed
                                                </div>
                                            ) : (
                                                pythonPackages.map((pkg, idx) => (
                                                    <div key={idx} className="flex justify-between items-center p-2 bg-gray-700 rounded text-sm">
                                                        <div>
                                                            <div className="font-medium">{pkg.name}</div>
                                                            <div className="text-xs text-gray-400">v{pkg.version}</div>
                                                        </div>
                                                        <LucideIcon icon={CheckCircle} className="w-4 h-4 text-green-400" />
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>

                                    <div className="p-3 bg-gray-700 rounded">
                                        <h3 className="text-sm font-medium mb-3">Quick Install</h3>
                                        <div className="grid grid-cols-2 gap-2">
                                            {['frida', 'objection', 'mitmproxy', 'requests', 'scapy', 'paramiko'].map(pkg => (
                                                <button
                                                    key={pkg}
                                                    onClick={() => {
                                                        setPythonPackages(prev => {
                                                            if (prev.find(p => p.name === pkg)) return prev;
                                                            addLog(`ðŸ“¦ Installing ${pkg}...`, 'info');
                                                            setTimeout(() => addLog(`âœ… ${pkg} installed`, 'success'), 1000);
                                                            return [...prev, { name: pkg, status: 'installed', version: '1.0.0' }];
                                                        });
                                                    }}
                                                    disabled={pythonPackages.find(p => p.name === pkg)}
                                                    className="px-3 py-2 bg-gray-600 hover:bg-gray-500 disabled:bg-gray-800 disabled:text-gray-600 rounded text-xs transition"
                                                >
                                                    {pkg}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="p-3 bg-blue-900/30 border border-blue-700 rounded text-xs">
                                        <div className="font-medium mb-2 text-blue-300">ðŸ’¡ Usage Tips:</div>
                                        <ul className="space-y-1 text-gray-300">
                                            <li>â€¢ Use <span className="font-mono bg-gray-800 px-1">frida</span> for runtime instrumentation</li>
                                            <li>â€¢ Use <span className="font-mono bg-gray-800 px-1">objection</span> for app analysis</li>
                                            <li>â€¢ Use <span className="font-mono bg-gray-800 px-1">mitmproxy</span> scripting for traffic manipulation</li>
                                        </ul>
                                    </div>
                                </div>
                            )}

                            {/* Traffic Tab */}
                            {activeTab === 'traffic' && (
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h3 className="text-sm font-medium">HTTP/HTTPS Traffic</h3>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => setTraffic([])}
                                                className="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs transition"
                                            >
                                                Clear
                                            </button>
                                            <button
                                                onClick={() => setCaptureTraffic(!captureTraffic)}
                                                className={`px-3 py-1 rounded text-xs transition ${
                                                    captureTraffic ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'
                                                }`}
                                            >
                                                {captureTraffic ? 'â¹ Stop' : 'â–¶ Capture'}
                                            </button>
                                        </div>
                                    </div>

                                    {!proxyEnabled && (
                                        <div className="p-3 bg-yellow-900/30 border border-yellow-700 rounded text-xs text-yellow-300">
                                            <LucideIcon icon={AlertCircle} className="w-4 h-4 inline mr-2" />
                                            Enable proxy to capture traffic
                                        </div>
                                    )}

                                    <div className="space-y-2">
                                        {traffic.length === 0 ? (
                                            <div className="text-sm text-gray-500 italic text-center py-8">
                                                {proxyEnabled ? 'Waiting for traffic...' : 'No traffic captured'}
                                            </div>
                                        ) : (
                                            traffic.map((req) => (
                                                <div 
                                                    key={req.id} 
                                                    className="p-3 bg-gray-700 rounded text-xs cursor-pointer hover:bg-gray-600 transition"
                                                    onClick={() => setSelectedTraffic(req)}
                                                >
                                                    <div className="flex justify-between items-center mb-2">
                                                        <span className={`font-bold ${
                                                            req.method === 'GET' ? 'text-blue-400' :
                                                            req.method === 'POST' ? 'text-green-400' :
                                                            req.method === 'PUT' ? 'text-yellow-400' :
                                                            'text-red-400'
                                                        }`}>
                                                            {req.method}
                                                        </span>
                                                        <span className="text-gray-400">{req.time}</span>
                                                    </div>
                                                    <div className="text-gray-300 break-all mb-2">{req.url}</div>
                                                    <div className="flex justify-between items-center">
                                                        <span className={`font-bold ${
                                                            req.status < 300 ? 'text-green-400' :
                                                            req.status < 400 ? 'text-blue-400' :
                                                            req.status < 500 ? 'text-yellow-400' : 'text-red-400'
                                                        }`}>Status: {req.status}</span>
                                                        <span className="text-gray-500 text-xs">{req.app}</span>
                                                    </div>
                                                    <div className="text-gray-500 text-xs mt-1">
                                                        Size: {req.size}
                                                    </div>
                                                    {req.headers && (
                                                        <details className="mt-2">
                                                            <summary className="cursor-pointer text-gray-400 hover:text-white">Headers</summary>
                                                            <div className="mt-2 p-2 bg-gray-800 rounded font-mono text-xs">
                                                                {Object.entries(req.headers).map(([key, value]) => (
                                                                    value && (
                                                                        <div key={key}>
                                                                            <span className="text-blue-400">{key}:</span> {value}
                                                                        </div>
                                                                    )
                                                                ))}
                                                            </div>
                                                        </details>
                                                    )}
                                                    {req.body && (
                                                        <details className="mt-2">
                                                            <summary className="cursor-pointer text-gray-400 hover:text-white">Body</summary>
                                                            <div className="mt-2 p-2 bg-gray-800 rounded font-mono text-xs break-all">
                                                                {req.body}
                                                            </div>
                                                        </details>
                                                    )}
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Logs Tab */}
                            {activeTab === 'logs' && (
                                <div className="space-y-2">
                                    <div className="flex justify-between items-center mb-2">
                                        <h3 className="text-sm font-medium">System Logs ({logs.length})</h3>
                                        <button
                                            onClick={() => setLogs([])}
                                            className="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs transition"
                                        >
                                            Clear All
                                        </button>
                                    </div>
                                    <div className="space-y-1 font-mono text-xs">
                                        {logs.length === 0 ? (
                                            <div className="text-gray-500 italic text-center py-8">No logs yet</div>
                                        ) : (
                                            logs.map((log, idx) => (
                                                <div key={idx} className={`p-2 rounded ${
                                                    log.type === 'error' ? 'bg-red-900/30 border border-red-700' :
                                                    log.type === 'success' ? 'bg-green-900/30 border border-green-700' :
                                                    'bg-gray-700'
                                                }`}>
                                                    <span className="text-gray-400">[{log.time}]</span>{' '}
                                                    <span className={
                                                        log.type === 'error' ? 'text-red-300' :
                                                        log.type === 'success' ? 'text-green-300' :
                                                        'text-gray-200'
                                                    }>{log.message}</span>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Toggle Side Panel Button */}
                    {!sidePanelOpen && (
                        <button
                            onClick={() => setSidePanelOpen(true)}
                            className="absolute right-4 top-4 p-3 bg-gray-800 hover:bg-gray-700 rounded-lg shadow-lg transition"
                        >
                            <LucideIcon icon={Menu} className="w-5 h-5" />
                        </button>
                    )}

                    {/* Traffic Details Modal */}
                    {selectedTraffic && <TrafficDetails traffic={selectedTraffic} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AndroidEmulator />);
    </script>
</body>
</html>

